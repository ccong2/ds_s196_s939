<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-11-22">

<title>Applied Data Science for Cities - Describe neighborhood dynamics with </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="../site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="../site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="../site_libs/react-17.0.0/react.min.js"></script>
<script src="../site_libs/react-17.0.0/react-dom.min.js"></script>
<script src="../site_libs/reactwidget-1.0.0/react-tools.js"></script>
<link href="../site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="../site_libs/reactable-binding-0.4.4/reactable.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Applied Data Science for Cities</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/index.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../labs/index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../howto/index.html" rel="" target="">
 <span class="menu-text">How To</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../labs/index.html">Labs</a></li><li class="breadcrumb-item"><a href="../labs/lab5.html">05 Walkable Environment: sf, osmdata packages</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01 Cambridge Building Energy: R, Quarto, dplyr essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Opportunity Zones: tidyverse, ggplot2 packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Racial Distribution: tidycensus, tidyr packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Airbnb in Chicago: plotly and leaflet packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">05 Walkable Environment: sf, osmdata packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../labs/lab6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">06 Build ShinyApp with Flexdashboard</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#components-included-in-the-index" id="toc-components-included-in-the-index" class="nav-link" data-scroll-target="#components-included-in-the-index">Components included in the index</a></li>
  <li><a href="#calculate-areas-and-lengths" id="toc-calculate-areas-and-lengths" class="nav-link" data-scroll-target="#calculate-areas-and-lengths">Calculate areas and lengths</a>
  <ul class="collapse">
  <li><a href="#density-of-sidewalks" id="toc-density-of-sidewalks" class="nav-link" data-scroll-target="#density-of-sidewalks">Density of sidewalks</a></li>
  </ul></li>
  <li><a href="#obtain-and-process-osm-data" id="toc-obtain-and-process-osm-data" class="nav-link" data-scroll-target="#obtain-and-process-osm-data">Obtain and process OSM data</a>
  <ul class="collapse">
  <li><a href="#the-bounding-box" id="toc-the-bounding-box" class="nav-link" data-scroll-target="#the-bounding-box">The bounding box</a></li>
  <li><a href="#the-key-value-pairs" id="toc-the-key-value-pairs" class="nav-link" data-scroll-target="#the-key-value-pairs">The key-value pairs</a></li>
  <li><a href="#write-a-function" id="toc-write-a-function" class="nav-link" data-scroll-target="#write-a-function">Write a function</a></li>
  <li><a href="#calculate-the-number-of-pois-by-neighborhood" id="toc-calculate-the-number-of-pois-by-neighborhood" class="nav-link" data-scroll-target="#calculate-the-number-of-pois-by-neighborhood">Calculate the number of POIs by neighborhood</a></li>
  <li><a href="#assemble-results" id="toc-assemble-results" class="nav-link" data-scroll-target="#assemble-results">Assemble results</a></li>
  </ul></li>
  <li><a href="#create-a-composite-index" id="toc-create-a-composite-index" class="nav-link" data-scroll-target="#create-a-composite-index">Create a composite index</a>
  <ul class="collapse">
  <li><a href="#standardize-indicators" id="toc-standardize-indicators" class="nav-link" data-scroll-target="#standardize-indicators">Standardize indicators</a></li>
  <li><a href="#specify-the-directions" id="toc-specify-the-directions" class="nav-link" data-scroll-target="#specify-the-directions">Specify the directions</a></li>
  <li><a href="#aggregate-the-index" id="toc-aggregate-the-index" class="nav-link" data-scroll-target="#aggregate-the-index">Aggregate the index</a></li>
  <li><a href="#check-the-result" id="toc-check-the-result" class="nav-link" data-scroll-target="#check-the-result">Check the result</a>
  <ul class="collapse">
  <li><a href="#optional" id="toc-optional" class="nav-link" data-scroll-target="#optional"><strong>Optional:</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#work-product" id="toc-work-product" class="nav-link" data-scroll-target="#work-product">Work Product</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Describe neighborhood dynamics with <img src="../img/Rlogo.png" class="img-fluid" width="60"></h1>
<p class="subtitle lead"><span style="color:#2C3E50">11.S954 Applied Data Science for Cities</span></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 22, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>Geospatial data analysis figures prominently in cities and urban analytics. In this lab, we will introduce essential tools and processes to facilitate spatial analysis, along with demonstrating how to obtain and integrate data from open data sources.</p>
<p>To put things into context, we are going to describe walkable environment in Boston neighborhoods. Walkability is regarded as whether characteristics of the built environment may or may not support residents to walk for either leisure or access destinations (Leslie et al., 2007). Some studies have further pinpointed several variables within a framework of three D’s supporting walkability: Density, Diversity, and Design (<a href="https://web.mit.edu/11.s946/www/readings/Cervero_1997.pdf">Cervero and Kockelman, 1997</a>, Ewing et al., 2008), and later, five D’s that further include Destination accessibility and Diversity (<a href="https://www.tandfonline.com/doi/abs/10.1080/01944361003766766">Ewing &amp; Cervero, 2010</a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="components-included-in-the-index" class="level1">
<h1>Components included in the index</h1>
<p>Suppose an advocacy group in the City of Boston wants to assess the walkability of neighborhoods in their built environment, and identifies the following indicators to describe the environment:</p>
<ul>
<li>Population density,</li>
<li>Business activities—e.g.&nbsp;retail, groceries, food—that are available within an area,</li>
<li>Sidewalk coverage (share of ground area used as sidewalks)</li>
</ul>
<p>These indicators can be operationalized as follows:</p>
<table class="table">
<colgroup>
<col style="width: 18%">
<col style="width: 66%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Indicator</th>
<th>Measure</th>
<th>Data Source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Population density</td>
<td>Population per sq.mi.</td>
<td>Analyze Boston</td>
</tr>
<tr class="even">
<td>Business activities</td>
<td>Number of selected POIs in the neighborhood per 1000 residents</td>
<td>OSM</td>
</tr>
<tr class="odd">
<td>Sidewalk coverage</td>
<td>The total length (ft) of sidewalk per area (sq.ft.) in each neighborhood</td>
<td>OSM</td>
</tr>
</tbody>
</table>
</section>
<section id="calculate-areas-and-lengths" class="level1">
<h1>Calculate areas and lengths</h1>
<p>Let’s gather, process data, and calculate these indicators one by one. First, we will need neighborhood boundaries, available on the Boston open data portal <a href="https://data.boston.gov/">Analyze Boston</a>. Let’s navigate to the <a href="https://data.boston.gov/dataset/boston-neighborhood-boundaries-approximated-by-2020-census-block-groups">Boston neighborhood boundaries approximated by 2020 census block groups</a> page. Find the shapefile format and click download to bring the zipped file to your data folder.</p>
<p>Although we can directly click to unzip it, let’s try to do it with R commands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> <span class="st">"data/Boston_Neighborhood_Boundaries_approximated_by_2020_Census_Block_Groups.zip"</span>, <span class="at">exdir =</span> <span class="st">"data"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">"data/Boston_Neighborhood_Boundaries_approximated_by_2020_Census_Block_Groups.zip"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we have the shapefile, we will use <code>st_read</code> in the <code>sf</code> package to read it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>neighborhood <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_read</span>(<span class="st">"data/Boston_Neighborhood_Boundaries_approximated_by_2020_Census_Block_Groups.shp"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">nbh_name =</span> blockgr202, <span class="at">population =</span> tot_pop_al)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that this shapefile has a population by neighborhood that is ready to use, which is very nice, otherwise we will have to aggregate the census population ourselves.</p>
<p>When we work with shapefiles from different sources, the first step is to check the <em>Coordinate Reference System (CRS)</em>. Places can appear differently in shape on maps when different CRSs are used due to the inherent distortions introduced during the process of projection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(neighborhood)<span class="sc">$</span>epsg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2249</code></pre>
</div>
</div>
<p>This informs us that the neighborhood shapefile is stored in a State Plane coordinate system Massachusetts Mainland, which has an EPSG code 2249. State Plane projections are 1) “projected”, meaning that x and y coordinates are in linear measurements, as opposed to degrees; and 2) are regional datums designed to provide accurate positioning data for North America specifically, as opposed to WGS84, which is a global datum. EPSG code is a standardized shorthand for referencing each CRS. Feel free to navigate to <a href="https://epsg.io/">epsg.io</a> and look around.</p>
<p>We can calculate polygon areas using <code>st_area()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>neighborhood <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nbh_area =</span> <span class="fu">st_area</span>(geometry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 24 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 739715.8 ymin: 2908294 xmax: 812981.4 ymax: 2970217
Projected CRS: NAD83 / Massachusetts Mainland (ftUS)
First 10 features:
      nbh_name population                       geometry
1      Allston      28621 MULTIPOLYGON (((758525.8 29...
2     Back Bay      19588 MULTIPOLYGON (((771539.2 29...
3  Beacon Hill       9336 MULTIPOLYGON (((774297.4 29...
4     Brighton      48330 MULTIPOLYGON (((754177.9 29...
5  Charlestown      19120 MULTIPOLYGON (((773132.5 29...
6    Chinatown       7143 MULTIPOLYGON (((775639 2953...
7   Dorchester     122191 MULTIPOLYGON (((775867.2 29...
8     Downtown      13451 MULTIPOLYGON (((773867.7 29...
9  East Boston      43066 MULTIPOLYGON (((790148.5 29...
10      Fenway      37733 MULTIPOLYGON (((756955.2 29...
                       nbh_area
1   41547595 [US_survey_foot^2]
2   15387245 [US_survey_foot^2]
3    7891524 [US_survey_foot^2]
4   76581557 [US_survey_foot^2]
5   51270214 [US_survey_foot^2]
6    3436019 [US_survey_foot^2]
7  219303798 [US_survey_foot^2]
8   21590100 [US_survey_foot^2]
9  181088272 [US_survey_foot^2]
10  42813573 [US_survey_foot^2]</code></pre>
</div>
</div>
<p>The new <code>nbh_area</code> column returns a unit object in square feet, which is consistent with the dataset’s projection. Although we can do basic math operations on unit objects, managing the units incurs memory overhead. Transforming them to simple numeric values is advisable if this information is not necessary to be carried along for the entire analysis.</p>
<p>Using the population information, we can proceed to compute the population per square mile and add this column to the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>neighborhood <span class="ot">&lt;-</span> neighborhood <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nbh_area =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geometry))) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_density =</span> population<span class="sc">/</span>(nbh_area<span class="sc">/</span><span class="dv">27878400</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="density-of-sidewalks" class="level2">
<h2 class="anchored" data-anchor-id="density-of-sidewalks">Density of sidewalks</h2>
<p>From the front page of Analyze Boston, search for “sidewalk”, you will find the <a href="https://data.boston.gov/dataset/sidewalk-centerline">Sidewalk Centerline</a> shapefile. Download it to your data folder, unzip it and read it in R. What CRS is this shapefile using?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sidewalk <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/Sidewalk_Centerline.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we intersect the sidewalk and neighborhood shapefiles, we should be able to calculate the total length of sidewalk segments in each neighborhood. Similar to <code>st_area</code>, <code>st_length</code> is another geometry measurement function and calculates segment length.</p>
<p>In the following code, we are going to:</p>
<ol type="1">
<li>intersect the sidewalk and neighborhood spatial objects, i.e.&nbsp;break up line segments at neighborhood boundaries;</li>
<li>calculate the lengths of sidewalk segments after the intersection;</li>
<li>convert the units to numeric values;</li>
<li>group the line segments by neighborhood, summing up the sidewalk lengths within each neighborhood.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sidewalk_data <span class="ot">&lt;-</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(sidewalk, neighborhood) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">as.numeric</span>(<span class="fu">st_length</span>(geometry))) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nbh_name) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sidewalk_length =</span> <span class="fu">sum</span>(length)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To calculate sidewalk coverage we need to join <code>sidewalk_length</code> with <code>neighborhood</code>, using the shared attribute <code>nbh_name</code> in these two datasets. Recall that operations on attributes do not remove their geometry - but we can explicitly drop it using <code>st_drop_geometry()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sidewalk_data <span class="ot">&lt;-</span>  sidewalk_data <span class="sc">|&gt;</span> <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(neighborhood, <span class="at">by =</span> <span class="st">"nbh_name"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we’ll calculate sidewalk density using another pipeline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sidewalk_data <span class="ot">&lt;-</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  sidewalk_data <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sidewalk_coverage =</span> sidewalk_length<span class="sc">/</span>nbh_area) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nbh_name, sidewalk_coverage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, you can remove some datasets that you don’t anticipate using again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(sidewalk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="obtain-and-process-osm-data" class="level1">
<h1>Obtain and process OSM data</h1>
<p>For the other nutrition-related variables, we are going to download points of interest (POI) from OpenStreetMap (OSM). By allowing anyone to contribute, OSM enables the real-time evolution of its database and offers convenient options for downloading data through its free <a href="https://overpass-turbo.eu/#">Overpass API</a>. In this lab, we will use the <a href="https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html"><code>osmdata</code> R package</a>, which simplifies download queries without much understanding of the overpass query syntax.</p>
<p>In order to obtain data from OSM, you will need to specify:</p>
<ul>
<li>a bounding box</li>
<li>key-value pairs</li>
</ul>
<section id="the-bounding-box" class="level3">
<h3 class="anchored" data-anchor-id="the-bounding-box">The bounding box</h3>
<p>A bounding box is like a window of where you want to clip a piece of map. It can be defined by manually specifying two longitude-latitude pairs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (lon, lat) of Lower left and Upper right corners </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">71.188</span>, <span class="fl">42.238</span>, <span class="sc">-</span><span class="fl">70.924</span>, <span class="fl">42.393</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In most cases, they can be directly identified by character strings.</p>
<p><code>bbox = 'Boston, MA, USA'</code></p>
<p>However, recently there seem to be some issues with <code>bbox</code> direct address query. I implemented <a href="https://stackoverflow.com/questions/76835293/error-when-querying-osmdata-package-http-405-method-not-allowed">a workaround here</a> so that we can still obtain a bounding box by entering a place name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This may need you to `install.packages("nominatimlite")`</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(nominatimlite<span class="sc">::</span><span class="fu">geo_lite_sf</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">address =</span> <span class="st">"Boston, MA, USA"</span>, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">points_only =</span> <span class="cn">FALSE</span>))   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-key-value-pairs" class="level3">
<h3 class="anchored" data-anchor-id="the-key-value-pairs">The key-value pairs</h3>
<p>An overpass query <code>opq</code> starts with engaging with the bounding box like this:</p>
<p><code>q &lt;- opq(bbox)</code></p>
<p>Following the initial <code>opq(bbox)</code> call, we will build queries by adding one or more features, which are specified in terms of <em>key-value pairs</em>.</p>
<p>Here is <a href="https://wiki.openstreetmap.org/wiki/Map_Features">a complete list of key-value pairs on OSM</a>, in which values can be understood as specific types of places, and keys are their categories. These are the keywords you can use when downloading OSM data.</p>
<p>For example, supermarket stores are categorized in OSM under <code>key=shop</code>, and <code>value=supermarket</code>. So a query of all supermarkets within the boundary box of Boston can be constructed as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>supermarket <span class="ot">&lt;-</span> <span class="fu">opq</span>(bbox)<span class="sc">|&gt;</span>   </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">"shop"</span>, <span class="at">value =</span> <span class="st">"supermarket"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The retrieved OSM object is a huge list that includes numerous attributes; What we need is an <code>sf</code> object named <code>osm_polygons</code> nested in this list. Let’s extract <code>osm_polygons</code>, then select only the name (and the attached geometry) of this object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>supermarket <span class="ot">&lt;-</span> supermarket<span class="sc">$</span>osm_polygons <span class="sc">|&gt;</span> <span class="fu">select</span>(name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make a quick plot, zoom in, and check the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">data =</span> supermarket)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-af94912ed4b9ef2c152d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-af94912ed4b9ef2c152d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addPolygons","args":[[[[{"lng":[-71.1206451,-71.12080330000001,-71.1207814,-71.12042099999999,-71.1203775,-71.12035419999999,-71.12026090000001,-71.1202845,-71.1202744,-71.1202567,-71.1201978,-71.1205284,-71.1205432,-71.1206451],"lat":[42.3416918,42.3419744,42.3420066,42.3421096,42.3420941,42.3421008,42.3419214,42.3419146,42.3418952,42.3419003,42.341787,42.3416925,42.341721,42.3416918]}]],[[{"lng":[-70.9910817,-70.9914022,-70.9912806,-70.9912228,-70.99084449999999,-70.9910817],"lat":[42.2414608,42.2415259,42.2420129,42.2421748,42.2420982,42.2414608]}]],[[{"lng":[-71.1130496,-71.113135,-71.113118,-71.1133699,-71.1132313,-71.1131345,-71.1131511,-71.1129866,-71.11298119999999,-71.112905,-71.1130496],"lat":[42.3735754,42.3735947,42.3736358,42.3736929,42.3740293,42.3740075,42.3739673,42.37393,42.3739431,42.3739258,42.3735754]}]],[[{"lng":[-70.996404,-70.99653309999999,-70.99659,-70.99663959999999,-70.9965807,-70.99630089999999,-70.99612260000001,-70.996404],"lat":[42.2536644,42.2537691,42.2537303,42.2537705,42.2538106,42.2540007,42.253856,42.2536644]}]],[[{"lng":[-71.0142105,-71.0141265,-71.014572,-71.01467270000001,-71.014602,-71.0146931,-71.01452740000001,-71.0144363,-71.0142105],"lat":[42.2661229,42.2659614,42.2657369,42.2658539,42.2658876,42.2660078,42.2661015,42.2659876,42.2661229]}]],[[{"lng":[-71.14980300000001,-71.1498189,-71.14931199999999,-71.148988,-71.14900179999999,-71.1487947,-71.1487478,-71.14880530000001,-71.1488003,-71.1487434,-71.1487047,-71.1486912,-71.148786,-71.1493542,-71.1493577,-71.1494304,-71.1494296,-71.14980300000001],"lat":[42.3748429,42.3748644,42.3758032,42.3756874,42.3757856,42.3758015,42.3754678,42.3754633,42.3754272,42.3754316,42.3751489,42.3750508,42.3750417,42.3749873,42.3749954,42.3749909,42.3749663,42.3748429]}]],[[{"lng":[-71.1111121,-71.1111891,-71.1109768,-71.110761,-71.110721,-71.110574,-71.11060999999999,-71.1107028,-71.11068400000001,-71.1111121],"lat":[42.3213306,42.3216368,42.3216662,42.3216961,42.3215371,42.3214805,42.3214291,42.3214647,42.32139,42.3213306]}]],[[{"lng":[-71.11415390000001,-71.1142009,-71.1143359,-71.1144658,-71.1143939,-71.1144101,-71.11390419999999,-71.1136381,-71.11346330000001,-71.1134443,-71.1138559,-71.11415390000001],"lat":[42.3607006,42.3607849,42.3607434,42.3609756,42.361029,42.3610579,42.3612135,42.3612954,42.3609829,42.3608278,42.3607923,42.3607006]}]],[[{"lng":[-71.04764280000001,-71.0473523,-71.0470413,-71.04733299999999,-71.04764280000001],"lat":[42.3516854,42.3520505,42.3519163,42.3515453,42.3516854]}]],[[{"lng":[-71.04081619999999,-71.0408171,-71.0408312,-71.0408971,-71.0409002,-71.0408348,-71.0408426,-71.0409679,-71.04090239999999,-71.04099239999999,-71.0409645,-71.0399707,-71.0399256,-71.0399245,-71.04039349999999,-71.0406103,-71.04081619999999],"lat":[42.3763308,42.3763413,42.3764997,42.376498,42.3765355,42.3765379,42.3766914,42.3767361,42.3768332,42.3768676,42.3769019,42.3769307,42.3763736,42.3763594,42.3763428,42.3763366,42.3763308]}]],[[{"lng":[-71.11430900000001,-71.11444830000001,-71.11409829999999,-71.11395899999999,-71.11430900000001],"lat":[42.3580643,42.358372,42.3584585,42.3581508,42.3580643]}]],[[{"lng":[-71.1232432,-71.1236256,-71.123617,-71.12404669999999,-71.12388060000001,-71.12306839999999,-71.1232432],"lat":[42.3522475,42.3522927,42.3523328,42.3523836,42.3531577,42.3530617,42.3522475]}]],[[{"lng":[-71.12014979999999,-71.1205587,-71.1205531,-71.1207091,-71.1208898,-71.1208676,-71.1208292,-71.1207991,-71.12078320000001,-71.1208228,-71.120801,-71.1199909,-71.1200135,-71.11987790000001,-71.119917,-71.1200403,-71.1201377,-71.12014979999999],"lat":[42.337892,42.3379429,42.3380102,42.3380205,42.3380324,42.3381346,42.3383127,42.3384551,42.3385259,42.3385331,42.338599,42.3384503,42.3383824,42.3383575,42.3381791,42.3379778,42.3379847,42.337892]}]],[[{"lng":[-71.04077580000001,-71.04105029999999,-71.04091680000001,-71.0411216,-71.0410959,-71.0410296,-71.0408559,-71.0406796,-71.04072480000001,-71.0405481,-71.0406471,-71.04069560000001,-71.0406629,-71.04077580000001],"lat":[42.2594729,42.2595465,42.2598215,42.2598764,42.2599293,42.2599116,42.2602694,42.2602859,42.2601925,42.2601451,42.2598137,42.2597142,42.2597054,42.2594729]}]],[[{"lng":[-71.0511205,-71.0513718,-71.0502637,-71.05001439999999,-71.05055,-71.0505175,-71.05075600000001,-71.0507866,-71.0511205],"lat":[42.3180039,42.3184319,42.3187903,42.3183655,42.3181924,42.318137,42.3180598,42.3181119,42.3180039]}]],[[{"lng":[-71.15696699999999,-71.15718529999999,-71.1572231,-71.1570048,-71.15696699999999],"lat":[42.2606838,42.2606568,42.260824,42.2608511,42.2606838]}]],[[{"lng":[-71.1390981,-71.1391234,-71.13905629999999,-71.1390688,-71.13924900000001,-71.13941,-71.1392432,-71.13925690000001,-71.1391125,-71.1389176,-71.1389739,-71.13895650000001,-71.1390981],"lat":[42.3372718,42.3373452,42.3373579,42.3373941,42.3373598,42.3378265,42.3378581,42.337898,42.3379254,42.3373603,42.3373496,42.3372988,42.3372718]}]],[[{"lng":[-71.10131629999999,-71.1015537,-71.10151860000001,-71.1015615,-71.10159899999999,-71.1020523,-71.1020039,-71.1021647,-71.1021202,-71.1020898,-71.10200810000001,-71.10180819999999,-71.10164399999999,-71.1012453,-71.101027,-71.1011883,-71.10131629999999],"lat":[42.3803572,42.3804382,42.3804903,42.3805057,42.3804527,42.3806036,42.3806952,42.3807564,42.3808311,42.3808174,42.3807957,42.3811252,42.381068,42.3809299,42.3808541,42.3805925,42.3803572]}]],[[{"lng":[-71.11167759999999,-71.11179060000001,-71.1122501,-71.11200890000001,-71.1120583,-71.1120887,-71.11211849999999,-71.1119953,-71.11132000000001,-71.11167759999999],"lat":[42.3832851,42.3833567,42.3836452,42.3838484,42.38388,42.3838995,42.3839185,42.3840243,42.3835921,42.3832851]}]],[[{"lng":[-71.0810322,-71.08153160000001,-71.08106720000001,-71.0804607,-71.08079619999999,-71.0809031,-71.0810322],"lat":[42.3087832,42.3090428,42.309535,42.3092196,42.3088642,42.3089199,42.3087832]}]],[[{"lng":[-71.1585881,-71.15846809999999,-71.15846500000001,-71.15861630000001,-71.1586697,-71.1586724,-71.1586731,-71.1586698,-71.1586654,-71.15864670000001,-71.1585881],"lat":[42.3706399,42.370541,42.3705386,42.3704474,42.3705382,42.3705395,42.3705655,42.3705711,42.3705867,42.3706067,42.3706399]}]],[[{"lng":[-71.1021428,-71.10219189999999,-71.1022395,-71.10222330000001,-71.10265699999999,-71.1026402,-71.1027624,-71.1026834,-71.10203079999999,-71.1021428],"lat":[42.3678816,42.3679006,42.3679191,42.367942,42.3681101,42.368134,42.3681814,42.3682934,42.3680404,42.3678816]}]],[[{"lng":[-71.1373296,-71.1374175,-71.1373734,-71.1381336,-71.1378758,-71.13779100000001,-71.137488,-71.1370483,-71.1370539,-71.13706879999999,-71.137019,-71.1372209,-71.1372729,-71.1373296],"lat":[42.3604478,42.3604693,42.3605685,42.3607546,42.3613823,42.3613615,42.3612874,42.3611798,42.3611671,42.3611335,42.3610162,42.3605624,42.3605752,42.3604478]}]],[[{"lng":[-71.08561880000001,-71.0861482,-71.08619469999999,-71.0862611,-71.0863245,-71.0863811,-71.0853923,-71.0852381,-71.0853315,-71.0849343,-71.0851553,-71.085081,-71.08561880000001],"lat":[42.3909271,42.3912216,42.3911758,42.3912139,42.3911504,42.391182,42.3921394,42.3920567,42.3919605,42.3917374,42.3915212,42.3914786,42.3909271]}]],[[{"lng":[-71.0268657,-71.0271917,-71.02729739999999,-71.0274799,-71.0272375,-71.0266026,-71.0264019,-71.0263641,-71.0262992,-71.02584210000001,-71.02588040000001,-71.0259259,-71.0259535,-71.0260002,-71.0260135,-71.0260665,-71.02639310000001,-71.02638930000001,-71.0264396,-71.0264375,-71.0264671,-71.0265132,-71.02661310000001,-71.02657290000001,-71.026681,-71.0266247,-71.0266694,-71.0267284,-71.0268657],"lat":[42.2705525,42.2708607,42.2707951,42.2709723,42.2711274,42.2714976,42.2716147,42.271579,42.2716168,42.2711845,42.2711119,42.2711252,42.2710725,42.2710861,42.2710609,42.2710762,42.2708857,42.2708145,42.270813,42.2707729,42.2707721,42.2708157,42.2707574,42.2707194,42.2706563,42.270603,42.2705769,42.2706326,42.2705525]}]],[[{"lng":[-71.1637903,-71.16397499999999,-71.16333400000001,-71.163321,-71.16256869999999,-71.16254429999999,-71.1627677,-71.1626363,-71.1627483,-71.162738,-71.16293880000001,-71.16293140000001,-71.16300990000001,-71.16300630000001,-71.1631084,-71.16311039999999,-71.1634538,-71.1634502,-71.1635517,-71.16356740000001,-71.16360090000001,-71.1636614,-71.1636529,-71.1637903],"lat":[42.2783711,42.2788291,42.2789717,42.2789396,42.2791068,42.2790462,42.2789966,42.2786705,42.2786457,42.27862,42.2785754,42.278557,42.2785395,42.2785308,42.2785081,42.278513,42.2784366,42.2784277,42.2784051,42.2784438,42.2784361,42.2784226,42.2784017,42.2783711]}]],[[{"lng":[-71.07003,-71.0700605,-71.07029850000001,-71.0696725,-71.0696401,-71.069565,-71.0695091,-71.06943510000001,-71.0694074,-71.0692569,-71.0691044,-71.07003],"lat":[42.2715482,42.2716019,42.2720202,42.2722151,42.2721581,42.2721815,42.2720832,42.2721063,42.2720577,42.2721045,42.2718364,42.2715482]}]],[[{"lng":[-71.05163810000001,-71.0516913,-71.0519031,-71.0521107,-71.0518361,-71.05163810000001],"lat":[42.3398842,42.3398376,42.3396523,42.3397803,42.3400063,42.3398842]}]],[[{"lng":[-71.1395996,-71.14083890000001,-71.1408294,-71.14077589999999,-71.1407172,-71.14063,-71.1404567,-71.1404423,-71.14038859999999,-71.1403893,-71.14026560000001,-71.140275,-71.1401747,-71.14016599999999,-71.14011910000001,-71.140108,-71.14001880000001,-71.139999,-71.13971770000001,-71.139707,-71.1396621,-71.1396467,-71.1395766,-71.1395598,-71.1394899,-71.1394624,-71.1395996],"lat":[42.3563295,42.3564997,42.3565381,42.3567546,42.3567465,42.3570792,42.3570554,42.3571102,42.3571099,42.357045,42.3570284,42.3569885,42.3569737,42.3570138,42.3570202,42.356989,42.3570046,42.3569489,42.3569087,42.3569452,42.3569548,42.3569249,42.3569432,42.3569127,42.3569338,42.3568755,42.3563295]}]],[[{"lng":[-71.1034535,-71.10345479999999,-71.1034963,-71.1035102,-71.1031811,-71.10318220000001,-71.1030291,-71.1030312,-71.1029369,-71.10293609999999,-71.1026652,-71.1026502,-71.1026164,-71.1026153,-71.10282979999999,-71.1028283,-71.1034535],"lat":[42.3237948,42.3238375,42.3238369,42.3242993,42.3243048,42.3243412,42.3243438,42.324414,42.3244156,42.3243864,42.3243909,42.3238948,42.3238953,42.3238587,42.3238551,42.3238051,42.3237948]}]],[[{"lng":[-71.1257461,-71.12609430000001,-71.1260571,-71.12611389999999,-71.1261214,-71.1262997,-71.12631690000001,-71.1263709,-71.1263172,-71.1266816,-71.1267082,-71.126577,-71.1265118,-71.12649589999999,-71.1262966,-71.12628890000001,-71.1262175,-71.1255256,-71.12553269999999,-71.12543669999999,-71.1256564,-71.12571749999999,-71.1257461],"lat":[42.251415,42.2515076,42.2515848,42.2515998,42.2515842,42.2516316,42.251596,42.2516103,42.2517213,42.2518184,42.2519063,42.2521783,42.252161,42.2521943,42.2521412,42.2521573,42.2521383,42.2519542,42.2519394,42.2519139,42.2514581,42.2514745,42.251415]}]],[[{"lng":[-71.1588921,-71.15884699999999,-71.158919,-71.1589311,-71.15907439999999,-71.1591196,-71.15911269999999,-71.1590875,-71.159059,-71.1589644,-71.1588921],"lat":[42.3703611,42.3703037,42.3702745,42.3702894,42.3702309,42.370233,42.3702752,42.3703904,42.3704205,42.3704607,42.3703611]}]],[[{"lng":[-71.10085650000001,-71.1009542,-71.1009798,-71.1010035,-71.10102500000001,-71.1009093,-71.100903,-71.1008071,-71.10056760000001,-71.1001212,-71.100064,-71.0999838,-71.0999041,-71.10085650000001],"lat":[42.343254,42.3434585,42.3434518,42.3435013,42.3435461,42.3435766,42.3435638,42.3435887,42.3436529,42.3437696,42.3436499,42.343671,42.3435046,42.343254]}]],[[{"lng":[-71.0343709,-71.034395,-71.0344431,-71.0343416,-71.03428940000001,-71.0343709],"lat":[42.3763785,42.3764169,42.37649,42.3765263,42.376447,42.3763785]}]],[[{"lng":[-71.10277290000001,-71.1027649,-71.10261629999999,-71.10229030000001,-71.10210979999999,-71.1018924,-71.1021283,-71.1021832,-71.1023572,-71.1026105,-71.10277290000001],"lat":[42.3650222,42.3650287,42.3651639,42.3654669,42.3656396,42.3655122,42.3652926,42.3653248,42.3651627,42.3649269,42.3650222]}]],[[{"lng":[-70.9240063,-70.9239812,-70.9240502,-70.92401030000001,-70.9239462,-70.9239285,-70.92322679999999,-70.9233061,-70.9240063],"lat":[42.2467977,42.2470994,42.2471026,42.2475818,42.2475789,42.2477432,42.24772,42.2467658,42.2467977]}]],[[{"lng":[-71.0422846,-71.04227419999999,-71.0430872,-71.0430772,-71.0431426,-71.0431353,-71.04319409999999,-71.0431482,-71.0432485,-71.0431968,-71.0429154,-71.0428749,-71.0415993,-71.04163130000001,-71.0414183,-71.04148600000001,-71.0414574,-71.04149820000001,-71.0418145,-71.0420611,-71.0422806,-71.0422846],"lat":[42.396053,42.3961127,42.3961892,42.3962471,42.3962533,42.3962952,42.3963008,42.3965661,42.3965756,42.3968747,42.3968487,42.3969687,42.3968482,42.3966632,42.3966431,42.3962518,42.3962505,42.3960065,42.3960046,42.3960164,42.396033,42.396053]}]],[[{"lng":[-70.9209986,-70.9209962,-70.92025580000001,-70.92025630000001,-70.9201712,-70.92017180000001,-70.92025649999999,-70.9202578,-70.9209986],"lat":[42.2500746,42.2497342,42.2497371,42.2498005,42.2498009,42.249884,42.2498837,42.2500774,42.2500746]}]],[[{"lng":[-71.1081372,-71.10737520000001,-71.1070969,-71.1072545,-71.10718489999999,-71.10769759999999,-71.10771509999999,-71.10780680000001,-71.1081372],"lat":[42.2620061,42.2624104,42.2621232,42.2620396,42.2619678,42.2616957,42.2617138,42.2616651,42.2620061]}]],[[{"lng":[-70.81987100000001,-70.8198257,-70.820286,-70.82091749999999,-70.8208444,-70.8208735,-70.82082490000001,-70.8208113,-70.8205935,-70.820607,-70.8205595,-70.82052950000001,-70.82046459999999,-70.8198794,-70.81987100000001],"lat":[42.2336619,42.233643,42.2330336,42.2332969,42.2333938,42.2334059,42.2334703,42.2334646,42.233753,42.2337586,42.2338214,42.2338089,42.2338948,42.2336508,42.2336619]}]],[[{"lng":[-71.11462040000001,-71.11457470000001,-71.11462299999999,-71.1146498,-71.1142546,-71.114144,-71.1140195,-71.11392650000001,-71.1138346,-71.1139277,-71.1137617,-71.11432139999999,-71.11462040000001],"lat":[42.275655,42.2756352,42.2755697,42.2755161,42.2753468,42.2752993,42.2754685,42.275431,42.275556,42.2755934,42.2758191,42.2760524,42.275655]}]],[[{"lng":[-71.1755498,-71.1756113,-71.1755593,-71.1748982,-71.1749097,-71.1747974,-71.17481100000001,-71.17458550000001,-71.1747943,-71.1749282,-71.1749169,-71.1756231,-71.17563440000001,-71.17573160000001,-71.1755498],"lat":[42.3186232,42.3186,42.3185246,42.3187738,42.3187904,42.3188327,42.3188524,42.3189374,42.3192402,42.3191897,42.3191734,42.3189072,42.3189235,42.3188869,42.3186232]}]],[[{"lng":[-70.9241105,-70.9237584,-70.9236033,-70.9239553,-70.9241105],"lat":[42.2491604,42.2492538,42.2489336,42.2488401,42.2491604]}]],[[{"lng":[-71.1255345,-71.1254473,-71.12539580000001,-71.1250314,-71.1251702,-71.1255345],"lat":[42.35274,42.3531282,42.3533578,42.3533131,42.3526953,42.35274]}]],[[{"lng":[-71.19130680000001,-71.1906673,-71.19055779999999,-71.1906362,-71.1906046,-71.19070240000001,-71.1907001,-71.1907598,-71.19093700000001,-71.1909338,-71.1909931,-71.1910917,-71.1911233,-71.191185,-71.19170699999999,-71.19167640000001,-71.19164739999999,-71.19130680000001],"lat":[42.3888017,42.3887731,42.3887028,42.3886362,42.3886159,42.3885328,42.3884866,42.388484,42.3883334,42.388288,42.3882857,42.3882019,42.3882222,42.3881698,42.3885049,42.3885309,42.3885122,42.3888017]}]],[[{"lng":[-71.0822884,-71.0819171,-71.0824892,-71.08272770000001,-71.0826285,-71.0827235,-71.0822884],"lat":[42.3329146,42.3332728,42.3335951,42.3333386,42.333264,42.3331765,42.3329146]}]],[[{"lng":[-71.0495519,-71.0490932,-71.0489384,-71.04895070000001,-71.0489705,-71.04898230000001,-71.04850570000001,-71.04857370000001,-71.04877689999999,-71.0488816,-71.049335,-71.0493522,-71.04936910000001,-71.04937390000001,-71.0495519],"lat":[42.2930245,42.2922288,42.2922776,42.292299,42.2923334,42.2923538,42.2925042,42.2926221,42.2929745,42.2931561,42.293013,42.2930429,42.2930723,42.2930806,42.2930245]}]],[[{"lng":[-70.99161770000001,-70.9916035,-70.991514,-70.9914275,-70.99178019999999,-70.9917708,-70.9919436,-70.9919537,-70.9920967,-70.9925669,-70.9928901,-70.99308190000001,-70.99161770000001],"lat":[42.2399247,42.2399636,42.2402122,42.2404552,42.2405268,42.2405548,42.2405886,42.2405618,42.2405908,42.2406844,42.2407476,42.2402161,42.2399247]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[42.2324694,42.3969687],"lng":[-71.19170699999999,-70.8198257]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Most of the supermarket locations are there. To prepare for our next step - joining them with our neighborhood dataset, we will do two additional things:</p>
<ol type="1">
<li>find the centroids for these supermarket polygons;</li>
<li>transform its CRS to be consistent with our neighborhood data.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>supermarket <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  supermarket <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>(geometry) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">2249</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="write-a-function" class="level3">
<h3 class="anchored" data-anchor-id="write-a-function">Write a function</h3>
<p>To streamline this “download - extract - transform” process, we can create a function to extract the specific elements required.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I name the function "get_osm". </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The inputs are place name and the key-value pair</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The output is a spatial point sf object that stores the centroid of POIs.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>get_osm <span class="ot">&lt;-</span> <span class="cf">function</span>(place, key, value){</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(nominatimlite<span class="sc">::</span><span class="fu">geo_lite_sf</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">address =</span> place,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">points_only =</span> <span class="cn">FALSE</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">opq</span>(bbox) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_osm_feature</span>(<span class="at">key =</span> key, <span class="at">value =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">osmdata_sf</span>()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> temp<span class="sc">$</span>osm_polygons <span class="sc">|&gt;</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_centroid</span>(geometry) <span class="sc">|&gt;</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="dv">2249</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s use our function to download more POIs that could describe business activities. Note that below is not an exhaustive list, there may be further relevant points to consider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>restaurant <span class="ot">&lt;-</span> <span class="fu">get_osm</span>(<span class="st">"Boston, MA, USA"</span>, <span class="st">"amenity"</span>, <span class="st">"restaurant"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fastfood <span class="ot">&lt;-</span> <span class="fu">get_osm</span>(<span class="st">"Boston, MA, USA"</span>, <span class="st">"amenity"</span>, <span class="st">"fast_food"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>retail <span class="ot">&lt;-</span> <span class="fu">get_osm</span>(<span class="st">"Boston, MA, USA"</span>, <span class="st">"building"</span>, <span class="st">"retail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculate-the-number-of-pois-by-neighborhood" class="level2">
<h2 class="anchored" data-anchor-id="calculate-the-number-of-pois-by-neighborhood">Calculate the number of POIs by neighborhood</h2>
<p>Once the three OSM variables are generated, we will count the number of points within each neighborhood. In the following code, <code>st_intersects</code> returns a list of 24 (the number of neighborhoods), in which each element contains IDs of the points falling within this polygon. We then apply <code>lengths()</code> to the elements of <code>st_intersects</code> to count the number of IDs. (<code>lengths</code> is a base R function, it’s not calculating spatial lengths, but getting the length of elements of a list).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The `bind_cols` brings multiple vectors together to make a data frame</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>osm_data <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(neighborhood<span class="sc">$</span>nbh_name,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(neighborhood, restaurant)),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(neighborhood, fastfood)),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(neighborhood, retail)),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(neighborhood, supermarket))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(osm_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nbh_name"</span>, <span class="st">"restaurant"</span>, <span class="st">"fastfood"</span>, <span class="st">"retail"</span>, <span class="st">"supermarket"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we will sum them up to have the total number of business-related POIs in each neighborhood, then factor in the population size to normalize the raw count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>osm_data <span class="ot">&lt;-</span> osm_data <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(neighborhood, <span class="at">by =</span> <span class="st">"nbh_name"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poi_density =</span> <span class="fu">ifelse</span>(population<span class="sc">&gt;</span><span class="dv">0</span>, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                              (restaurant<span class="sc">+</span>fastfood<span class="sc">+</span>retail<span class="sc">+</span>supermarket)<span class="sc">/</span>(population<span class="sc">/</span><span class="dv">1000</span>), </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nbh_name, poi_density)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assemble-results" class="level2">
<h2 class="anchored" data-anchor-id="assemble-results">Assemble results</h2>
<p>Now we will put the three parts of our result (population density, sidewalk coverage, and POI data) in one place. The three datasets we have created share the common attribute <code>nbh_name</code>. We can perform <code>left_join()</code> on two datasets at a time, but an alternative strategy is to use the <code>purrr</code> package’s&nbsp;<code>reduce()</code>&nbsp;function to combine multiple datasets at one time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(neighborhood, sidewalk_data, osm_data) <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(left_join, <span class="at">by =</span> <span class="st">"nbh_name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have finally compiled the necessary dataset that incorporates all the indicators we have identified! Now let’s remove intermediary variables in the working environment, keeping only the <code>data</code> and prepare to create the index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="st">"data"</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(population, nbh_area))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-a-composite-index" class="level1">
<h1>Create a composite index</h1>
<p>There are many different methods to combine variables. We are going to create a relatively simple additive index by adding up our three indicators with equal weights. But before that, we need to standardize our variables to make sure they are at a comparable scale.</p>
<section id="standardize-indicators" class="level2">
<h2 class="anchored" data-anchor-id="standardize-indicators">Standardize indicators</h2>
<p>Since our indicators end up having very different scales, we can’t interpret anything about the magnitude by comparing these values to each other. In many statistical analyses, such as multivariate linear regression, standardizing your data is usually an essential first step to prevent certain variables from dominating the analysis due to their larger numerical values.</p>
<p>Z-score standardization converts data from various distributions into a common <em>unit</em> of measurement, which is the number of standard deviations from the mean. This conversion enables data points, regardless of their original spread, to be expressed in the same way.</p>
<p>A z-score can be calculated by subtracting from a given observation the mean of all observations and then dividing by the standard deviation of all observations. R has us covered here - the <code>scale</code> function does exactly the same thing. Here we use a <code>mutate_at</code> function to perform the same alteration upon multiple variables we select. Take a look at the documentation for <code>mutate_at</code>, the <code>list</code> argument allows you to modify existing columns in place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(pop_density, sidewalk_coverage, poi_density),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(scale)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="specify-the-directions" class="level2">
<h2 class="anchored" data-anchor-id="specify-the-directions">Specify the directions</h2>
<p>High values in indicators may represent beneficial or detrimental conditions - in some cases, higher values are “good”, and in some cases, lower values are “good”. When we are creating an additive index, we can transform values so that they are moving in the same direction by simply switching the sign on the values that need to be reversed (e.g.&nbsp;multiply by -1). However, we don’t need to adjust directions in our case because our indicators move in the same direction (i.e.&nbsp;high values mean a more walkable environment).</p>
</section>
<section id="aggregate-the-index" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-the-index">Aggregate the index</h2>
<p>Now we are going to generate our composite index, where standardized values are simply added together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span> score <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="fu">sum</span>(pop_density, sidewalk_coverage, poi_density))<span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may have noticed&nbsp;<code>rowwise()</code>. Typically, if we were to ask <code>dplyr</code> to mutate by providing a sum, it would do so by column.&nbsp;<code>rowwise()</code>&nbsp;modifies this and asks for something to happen across a data observation (row) instead of by column.</p>
<p>We could analyze the index value and interpret it as is, but for an index, it’s reasonable to anticipate a value falling within the range of 0 to 100. We can use <code>rescale</code> to put our values into any specified range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  score <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">rescale</span>(index, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-the-result" class="level2">
<h2 class="anchored" data-anchor-id="check-the-result">Check the result</h2>
<p>We can make a quick map to examine our results. Although, we don’t have to over-interpret our results because any method to evaluate walkability is a difficult one. OpenStreetMap also exhibits issues such as missing names, data availability biases, inconsistent categorization, etc. This study chose a more pragmatic method to demonstrate the capabilities of R in data management and spatial analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(score) <span class="sc">+</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> index))<span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab5_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="optional" class="level3">
<h3 class="anchored" data-anchor-id="optional"><strong>Optional:</strong></h3>
<p>In response to suggestions - here are some other approaches for presenting our results! For example, a formatted and sortable table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rescore the sub-dimensional indices to 0-100 as well</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>score <span class="ot">&lt;-</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  score <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(pop_density, sidewalk_coverage, poi_density),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">rescale</span>(., <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>score<span class="sc">|&gt;</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_if</span>(<span class="sc">~</span><span class="fu">is.numeric</span>(.), <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">columns =</span> nbh_name),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>(</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_compact_mode =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_text_wrapping =</span> <span class="cn">FALSE</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="purouzpmvn" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#purouzpmvn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#purouzpmvn thead, #purouzpmvn tbody, #purouzpmvn tfoot, #purouzpmvn tr, #purouzpmvn td, #purouzpmvn th {
  border-style: none;
}

#purouzpmvn p {
  margin: 0;
  padding: 0;
}

#purouzpmvn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#purouzpmvn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#purouzpmvn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#purouzpmvn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#purouzpmvn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#purouzpmvn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#purouzpmvn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#purouzpmvn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#purouzpmvn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#purouzpmvn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#purouzpmvn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#purouzpmvn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#purouzpmvn .gt_spanner_row {
  border-bottom-style: hidden;
}

#purouzpmvn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#purouzpmvn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#purouzpmvn .gt_from_md > :first-child {
  margin-top: 0;
}

#purouzpmvn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#purouzpmvn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#purouzpmvn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#purouzpmvn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#purouzpmvn .gt_row_group_first td {
  border-top-width: 2px;
}

#purouzpmvn .gt_row_group_first th {
  border-top-width: 2px;
}

#purouzpmvn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#purouzpmvn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#purouzpmvn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#purouzpmvn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#purouzpmvn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#purouzpmvn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#purouzpmvn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#purouzpmvn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#purouzpmvn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#purouzpmvn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#purouzpmvn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#purouzpmvn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#purouzpmvn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#purouzpmvn .gt_left {
  text-align: left;
}

#purouzpmvn .gt_center {
  text-align: center;
}

#purouzpmvn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#purouzpmvn .gt_font_normal {
  font-weight: normal;
}

#purouzpmvn .gt_font_bold {
  font-weight: bold;
}

#purouzpmvn .gt_font_italic {
  font-style: italic;
}

#purouzpmvn .gt_super {
  font-size: 65%;
}

#purouzpmvn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#purouzpmvn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#purouzpmvn .gt_indent_1 {
  text-indent: 5px;
}

#purouzpmvn .gt_indent_2 {
  text-indent: 10px;
}

#purouzpmvn .gt_indent_3 {
  text-indent: 15px;
}

#purouzpmvn .gt_indent_4 {
  text-indent: 20px;
}

#purouzpmvn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div id="purouzpmvn" class="reactable html-widget " style="width:auto;height:auto;"></div>
<script type="application/json" data-for="purouzpmvn">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"nbh_name":["Allston","Back Bay","Beacon Hill","Brighton","Charlestown","Chinatown","Dorchester","Downtown","East Boston","Fenway","Harbor Islands","Hyde Park","Jamaica Plain","Longwood","Mattapan","Mission Hill","North End","Roslindale","Roxbury","South Boston","South Boston Waterfront","South End","West End","West Roxbury"],"pop_density":[[33.14],[61.24],[56.91],[30.36],[17.94],[100],[26.8],[29.97],[11.44],[42.4],[0],[11.4],[17.4],[28.76],[19.63],[57.24],[61.36],[21.07],[27.37],[26.51],[5.63],[63.05],[44.26],[10.42]],"sidewalk_coverage":[[51.39],[90.29],[100],[55.03],[46.6],[86.44],[52.39],[66.87],[17.77],[44.15],[0],[31.09],[44.38],[72.83],[44.43],[82.41],[62.58],[49.96],[62.6],[51.97],[21.18],[94.59],[57.07],[35.72]],"poi_density":[[100],[48.13],[36.07],[27.87],[10.57],[9.43],[33.34],[45.06],[18.76],[12.49],["NA"],[28.56],[13.96],[16.44],[7.06],[0],[49.86],[27.5],[9.2],[17.76],[24.14],[11.46],[4.37],[14.94]],"index":[94.36,100,94.49,42.61,16.52,95.4,42.54,62.23,0,32.66,"NA",15.43,17.22,44.47,13.75,57.57,83.92,32.97,31.87,30.81,2.16,77.38,36.15,7.84]},"columns":[{"id":"nbh_name","name":"nbh_name","type":"character","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\nif (colInfo.id === 'nbh_name' & rowIndex === 1) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 2) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 3) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 4) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 5) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 6) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 7) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 8) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 9) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 10) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 11) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 12) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 13) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 14) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 15) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 16) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 17) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 18) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 19) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 20) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 21) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 22) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 23) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 24) {\n  return { fontWeight: 'bold' }\n}\n\n}","cell":["Allston","Back Bay","Beacon Hill","Brighton","Charlestown","Chinatown","Dorchester","Downtown","East Boston","Fenway","Harbor Islands","Hyde Park","Jamaica Plain","Longwood","Mattapan","Mission Hill","North End","Roslindale","Roxbury","South Boston","South Boston Waterfront","South End","West End","West Roxbury"],"html":true,"align":"left","headerStyle":{"font-weight":"normal"}},{"id":"pop_density","name":"pop_density","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\nif (colInfo.id === 'nbh_name' & rowIndex === 1) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 2) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 3) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 4) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 5) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 6) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 7) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 8) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 9) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 10) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 11) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 12) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 13) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 14) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 15) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 16) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 17) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 18) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 19) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 20) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 21) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 22) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 23) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 24) {\n  return { fontWeight: 'bold' }\n}\n\n}","cell":["33.14","61.24","56.91","30.36","17.94","100.00","26.80","29.97","11.44","42.40","0.00","11.40","17.40","28.76","19.63","57.24","61.36","21.07","27.37","26.51","5.63","63.05","44.26","10.42"],"html":true,"align":"center","headerStyle":{"font-weight":"normal"}},{"id":"sidewalk_coverage","name":"sidewalk_coverage","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\nif (colInfo.id === 'nbh_name' & rowIndex === 1) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 2) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 3) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 4) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 5) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 6) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 7) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 8) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 9) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 10) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 11) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 12) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 13) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 14) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 15) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 16) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 17) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 18) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 19) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 20) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 21) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 22) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 23) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 24) {\n  return { fontWeight: 'bold' }\n}\n\n}","cell":["51.39","90.29","100.00","55.03","46.60","86.44","52.39","66.87","17.77","44.15","0.00","31.09","44.38","72.83","44.43","82.41","62.58","49.96","62.60","51.97","21.18","94.59","57.07","35.72"],"html":true,"align":"center","headerStyle":{"font-weight":"normal"}},{"id":"poi_density","name":"poi_density","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\nif (colInfo.id === 'nbh_name' & rowIndex === 1) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 2) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 3) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 4) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 5) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 6) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 7) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 8) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 9) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 10) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 11) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 12) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 13) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 14) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 15) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 16) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 17) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 18) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 19) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 20) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 21) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 22) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 23) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 24) {\n  return { fontWeight: 'bold' }\n}\n\n}","cell":["100.00","48.13","36.07","27.87","10.57","9.43","33.34","45.06","18.76","12.49","NA","28.56","13.96","16.44","7.06","0.00","49.86","27.50","9.20","17.76","24.14","11.46","4.37","14.94"],"html":true,"align":"center","headerStyle":{"font-weight":"normal"}},{"id":"index","name":"index","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\nif (colInfo.id === 'nbh_name' & rowIndex === 1) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 2) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 3) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 4) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 5) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 6) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 7) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 8) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 9) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 10) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 11) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 12) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 13) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 14) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 15) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 16) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 17) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 18) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 19) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 20) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 21) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 22) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 23) {\n  return { fontWeight: 'bold' }\n}\n\nif (colInfo.id === 'nbh_name' & rowIndex === 24) {\n  return { fontWeight: 'bold' }\n}\n\n}","cell":["94.36","100.00","94.49","42.61","16.52","95.40","42.54","62.23","0.00","32.66","NA","15.43","17.22","44.47","13.75","57.57","83.92","32.97","31.87","30.81","2.16","77.38","36.15","7.84"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":10,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"compact":true,"nowrap":true,"showSortable":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"headerStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3","borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"purouzpmvn","dataKey":"12267122c7681a4461818716a13bd287"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style","tag.attribs.columns.3.style","tag.attribs.columns.4.style"],"jsHooks":[]}</script>
</div>
</div>
</div>
<p>Or, we can make some <a href="https://r-graph-gallery.com/143-spider-chart-with-saveral-individuals.html">radar charts</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nbh <span class="ot">=</span> <span class="st">"Downtown"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The radar chart requires only value columns</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> score <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nbh_name <span class="sc">==</span> nbh)<span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pop_density, sidewalk_coverage, poi_density)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># I also have to manually add 2 new row: the max and min of each indicator</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">rep</span>(<span class="dv">100</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>), temp) </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fmsb)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">radarchart</span>(temp, <span class="at">title =</span> nbh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lab5_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="exercise" class="level1">
<h1>Exercise</h1>
<p>This exercise will be a self-guided mini research to evaluate the <strong>public transportation service (supply)</strong> of selected Boston neighborhoods. You will define 3-4 indicators that describe existing public transportation services, formulate your analysis strategy, calculate the indicators, then focus on two neighborhoods in Boston to compare your results and evaluate the public transportation supply in your study areas.</p>
<p>You can describe public transportation service by number of bus and rail stops, number of routes, length of bike routes and sidewalks, etc. You can download the datasets you need from Boston websites or OSM. The primary purpose of this exercise is to practice spatial analysis in R. You should operationalize the metrics in a manageable way and specify indicators that work for you.</p>
</section>
<section id="work-product" class="level1">
<h1>Work Product</h1>
<p>Please document your work process and results in a new Quarto Document, and <strong>upload your .qmd file and rendered HTML file to Canvas</strong> <strong>by the end of day, Tuesday, Dec 5.</strong></p>
<p>A quick tip: if you include <code>self_contained = TRUE</code> in your YAML header, you won’t lose the pictures of your html file.</p>
<p><img src="..\img/lab3-html.PNG" class="img-fluid"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with R and <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>